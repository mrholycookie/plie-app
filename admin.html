<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∫–∞ Dance News - –†–µ–¥–∞–∫—Ç–æ—Ä JSON</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 14px;
        }

        input, textarea, select {
            padding: 10px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .array-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .array-input input {
            flex: 1;
        }

        .array-list {
            margin-top: 10px;
        }

        .array-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .array-item span {
            flex: 1;
        }

        .items-list {
            margin-top: 30px;
        }

        .item-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .item-card h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        .item-card .item-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .item-card .item-info strong {
            color: #667eea;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .gist-config {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .gist-config h3 {
            margin-bottom: 10px;
            color: #856404;
        }

        .gist-config input {
            margin-bottom: 10px;
        }

        .status-message {
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.show {
            display: block;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ –ê–¥–º–∏–Ω–∫–∞ Dance News</h1>
            <p>–†–µ–¥–∞–∫—Ç–æ—Ä JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</p>
        </div>

        <div class="status-message" id="statusMessage"></div>

        <div class="controls">
            <div class="file-input-wrapper">
                <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">
                    üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON
                </button>
                <input type="file" id="fileInput" accept=".json" style="display: none;">
            </div>
            <button class="btn btn-primary" onclick="saveToFile()">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
            </button>
            <button class="btn btn-success" onclick="saveToGist()" id="saveGistBtn" style="display: none;">
                ‚òÅÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Gist
            </button>
            <button class="btn btn-secondary" onclick="exportJSON()">
                üì§ –≠–∫—Å–ø–æ—Ä—Ç JSON
            </button>
            <button class="btn btn-danger" onclick="clearAll()">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
            </button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('studios')">–°—Ç—É–¥–∏–∏</button>
            <button class="tab" onclick="switchTab('education')">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</button>
            <button class="tab" onclick="switchTab('events')">–°–æ–±—ã—Ç–∏—è</button>
            <button class="tab" onclick="switchTab('rss')">RSS</button>
            <button class="tab" onclick="switchTab('telegram')">Telegram</button>
            <button class="tab" onclick="switchTab('vk')">VK</button>
            <button class="tab" onclick="switchTab('gist')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Gist</button>
        </div>

        <!-- –°—Ç—É–¥–∏–∏ -->
        <div id="tab-studios" class="tab-content active">
            <h2>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–∏—é</h2>
            <form id="studioForm" onsubmit="addStudio(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>ID *</label>
                        <input type="text" id="studio-id" required>
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="studio-name" required>
                    </div>
                    <div class="form-group">
                        <label>–ì–æ—Ä–æ–¥ *</label>
                        <input type="text" id="studio-city" required>
                    </div>
                    <div class="form-group">
                        <label>–ú–µ—Ç—Ä–æ *</label>
                        <input type="text" id="studio-metro" required>
                    </div>
                    <div class="form-group">
                        <label>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è *</label>
                        <input type="url" id="studio-image" required>
                    </div>
                    <div class="form-group">
                        <label>URL —Å–∞–π—Ç–∞ *</label>
                        <input type="url" id="studio-url" required>
                    </div>
                    <div class="form-group">
                        <label>–ê–¥—Ä–µ—Å</label>
                        <input type="text" id="studio-address">
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat, lng —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" id="studio-coords" placeholder="55.7558, 37.6173">
                    </div>
                    <div class="form-group full-width">
                        <label>–°—Ç–∏–ª–∏ —Ç–∞–Ω—Ü–µ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) *</label>
                        <input type="text" id="studio-styles" placeholder="–ë–∞–ª–µ—Ç, –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–∞–Ω–µ—Ü" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–∏—é</button>
            </form>
            <div class="items-list" id="studiosList"></div>
        </div>

        <!-- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ -->
        <div id="tab-education" class="tab-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ</h2>
            <form id="educationForm" onsubmit="addEducation(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>ID *</label>
                        <input type="text" id="edu-id" required>
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="edu-name" required>
                    </div>
                    <div class="form-group">
                        <label>–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="edu-short-name" required>
                    </div>
                    <div class="form-group">
                        <label>–ì–æ—Ä–æ–¥ *</label>
                        <input type="text" id="edu-city" required>
                    </div>
                    <div class="form-group full-width">
                        <label>–°—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ç–µ–π) *</label>
                        <input type="text" id="edu-metro" placeholder="–ö—Ä–æ–ø–æ—Ç–∫–∏–Ω—Å–∫–∞—è, –ü–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã" required>
                    </div>
                    <div class="form-group">
                        <label>–¢–∏–ø *</label>
                        <select id="edu-type" required>
                            <option value="–ê–∫–∞–¥–µ–º–∏—è">–ê–∫–∞–¥–µ–º–∏—è</option>
                            <option value="–ò–Ω—Å—Ç–∏—Ç—É—Ç">–ò–Ω—Å—Ç–∏—Ç—É—Ç</option>
                            <option value="–ö–æ–ª–ª–µ–¥–∂">–ö–æ–ª–ª–µ–¥–∂</option>
                            <option value="–í–£–ó">–í–£–ó</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è *</label>
                        <input type="url" id="edu-image" required>
                    </div>
                    <div class="form-group">
                        <label>URL —Å–∞–π—Ç–∞ *</label>
                        <input type="url" id="edu-url" required>
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat, lng —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" id="edu-coords" placeholder="55.7558, 37.6173">
                    </div>
                    <div class="form-group full-width">
                        <label>–£—Ä–æ–≤–Ω–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) *</label>
                        <input type="text" id="edu-level" placeholder="–í—ã—Å—à–µ–µ, –°—Ä–µ–¥–Ω–µ–µ" required>
                    </div>
                    <div class="form-group full-width">
                        <label>–ü—Ä–æ–≥—Ä–∞–º–º—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) *</label>
                        <input type="text" id="edu-programs" placeholder="–ë–∞–ª–µ—Ç, –•–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ</button>
            </form>
            <div class="items-list" id="educationList"></div>
        </div>

        <!-- –°–æ–±—ã—Ç–∏—è -->
        <div id="tab-events" class="tab-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</h2>
            <form id="eventForm" onsubmit="addEvent(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>ID *</label>
                        <input type="number" id="event-id" required>
                    </div>
                    <div class="form-group full-width">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="event-title" required>
                    </div>
                    <div class="form-group full-width">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                        <textarea id="event-description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="url" id="event-image">
                    </div>
                    <div class="form-group">
                        <label>URL —Å–∞–π—Ç–∞ *</label>
                        <input type="url" id="event-site-url" required>
                    </div>
                    <div class="form-group">
                        <label>–ú–µ—Å—Ç–æ *</label>
                        <input type="text" id="event-place" required>
                    </div>
                    <div class="form-group">
                        <label>–ì–æ—Ä–æ–¥ *</label>
                        <input type="text" id="event-city" required>
                    </div>
                    <div class="form-group">
                        <label>–¶–µ–Ω–∞ *</label>
                        <input type="text" id="event-price" required>
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ (YYYY-MM-DD HH:MM) *</label>
                        <input type="datetime-local" id="event-start-date" required>
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (YYYY-MM-DD HH:MM)</label>
                        <input type="datetime-local" id="event-end-date">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
            </form>
            <div class="items-list" id="eventsList"></div>
        </div>

        <!-- RSS -->
        <div id="tab-rss" class="tab-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å RSS —Ñ–∏–¥</h2>
            <form id="rssForm" onsubmit="addRss(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>URL *</label>
                        <input type="url" id="rss-url" required>
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="rss-name" required>
                    </div>
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <input type="text" id="rss-category" required>
                    </div>
                    <div class="form-group">
                        <label>–í–∫–ª—é—á–µ–Ω</label>
                        <input type="checkbox" id="rss-enabled" checked>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å RSS</button>
            </form>
            <div class="items-list" id="rssList"></div>
        </div>

        <!-- Telegram -->
        <div id="tab-telegram" class="tab-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å Telegram –∫–∞–Ω–∞–ª</h2>
            <form id="telegramForm" onsubmit="addTelegram(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>ID –∫–∞–Ω–∞–ª–∞ *</label>
                        <input type="text" id="telegram-id" required>
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="telegram-name" required>
                    </div>
                    <div class="form-group">
                        <label>–í–∫–ª—é—á–µ–Ω</label>
                        <input type="checkbox" id="telegram-enabled" checked>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª</button>
            </form>
            <div class="items-list" id="telegramList"></div>
        </div>

        <!-- VK -->
        <div id="tab-vk" class="tab-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å VK –≥—Ä—É–ø–ø—É</h2>
            <form id="vkForm" onsubmit="addVk(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>ID –≥—Ä—É–ø–ø—ã *</label>
                        <input type="text" id="vk-id" required>
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="vk-name" required>
                    </div>
                    <div class="form-group">
                        <label>–í–∫–ª—é—á–µ–Ω</label>
                        <input type="checkbox" id="vk-enabled" checked>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</button>
            </form>
            <div class="items-list" id="vkList"></div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Gist -->
        <div id="tab-gist" class="tab-content">
            <div class="gist-config">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub Gist</h3>
                <p>–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Gist —É–∫–∞–∂–∏—Ç–µ:</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Gist ID</label>
                        <input type="text" id="gist-id" placeholder="abc123def456...">
                    </div>
                    <div class="form-group">
                        <label>GitHub Token (Personal Access Token)</label>
                        <input type="password" id="gist-token" placeholder="ghp_...">
                        <small style="margin-top: 5px; color: #6c757d; display: block;">
                            <strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: Classic Token</strong><br>
                            –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω: Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí <strong>Tokens (classic)</strong> ‚Üí Generate new token (classic)<br>
                            –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞: <code>gist</code><br>
                            <em>Fine-grained tokens —Ç–æ–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è, –Ω–æ Classic –ø—Ä–æ—â–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</em>
                        </small>
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveGistConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>
    </div>

    <script>
        let data = {
            studios: [],
            education: [],
            events: [],
            rss: [],
            rss_world: [],
            telegram: [],
            vk: [],
            vk_clips: []
        };

        let gistConfig = {
            id: localStorage.getItem('gist_id') || '',
            token: localStorage.getItem('gist_token') || ''
        };

        // –ò–Ω–¥–µ–∫—Å—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –∑–∞–ø–∏—Å–µ–π
        let editingIndex = {
            studios: null,
            education: null,
            events: null,
            rss: null,
            telegram: null,
            vk: null
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.getElementById('fileInput').addEventListener('change', handleFileLoad);
        if (gistConfig.id && gistConfig.token) {
            document.getElementById('saveGistBtn').style.display = 'inline-flex';
        }
        loadGistConfig();
        renderAll();

        function switchTab(tabName) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
            resetEditingMode();
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        function resetEditingMode() {
            Object.keys(editingIndex).forEach(key => {
                if (editingIndex[key] !== null) {
                    editingIndex[key] = null;
                    const formId = key === 'studios' ? 'studioForm' : 
                                  key === 'education' ? 'educationForm' :
                                  key === 'events' ? 'eventForm' :
                                  key === 'rss' ? 'rssForm' :
                                  key === 'telegram' ? 'telegramForm' :
                                  key === 'vk' ? 'vkForm' : null;
                    if (formId) {
                        const form = document.getElementById(formId);
                        if (form) {
                            form.reset();
                            const submitBtn = form.querySelector('button[type="submit"]');
                            if (submitBtn && submitBtn.textContent.includes('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å')) {
                                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                                const originalTexts = {
                                    'studioForm': '‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–∏—é',
                                    'educationForm': '‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ',
                                    'eventForm': '‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ',
                                    'rssForm': '‚ûï –î–æ–±–∞–≤–∏—Ç—å RSS',
                                    'telegramForm': '‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª',
                                    'vkForm': '‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É'
                                };
                                submitBtn.textContent = originalTexts[formId] || submitBtn.textContent;
                            }
                        }
                    }
                }
            });
        }

        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type} show`;
            setTimeout(() => {
                statusEl.classList.remove('show');
            }, 3000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ JSON
        function handleFileLoad(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    data = JSON.parse(e.target.result);
                    renderAll();
                    showStatus('JSON —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                } catch (error) {
                    showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ JSON: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        // –°—Ç—É–¥–∏–∏
        function addStudio(e) {
            e.preventDefault();
            const coords = parseCoords(document.getElementById('studio-coords').value);
            const studio = {
                id: document.getElementById('studio-id').value,
                name: document.getElementById('studio-name').value,
                city: document.getElementById('studio-city').value,
                metro: document.getElementById('studio-metro').value,
                image: document.getElementById('studio-image').value,
                url: document.getElementById('studio-url').value,
                address: document.getElementById('studio-address').value || undefined,
                coords: coords,
                styles: document.getElementById('studio-styles').value.split(',').map(s => s.trim()).filter(s => s)
            };
            
            if (editingIndex.studios !== null) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                data.studios[editingIndex.studios] = studio;
                editingIndex.studios = null;
                document.getElementById('studioForm').reset();
                document.getElementById('studioForm').querySelector('button[type="submit"]').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–∏—é';
                renderStudios();
                showStatus('–°—Ç—É–¥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                data.studios.push(studio);
                document.getElementById('studioForm').reset();
                renderStudios();
                showStatus('–°—Ç—É–¥–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            }
        }

        function editStudio(index) {
            const studio = data.studios[index];
            document.getElementById('studio-id').value = studio.id || '';
            document.getElementById('studio-name').value = studio.name || '';
            document.getElementById('studio-city').value = studio.city || '';
            document.getElementById('studio-metro').value = Array.isArray(studio.metro) ? studio.metro.join(', ') : (studio.metro || '');
            document.getElementById('studio-image').value = studio.image || '';
            document.getElementById('studio-url').value = studio.url || '';
            document.getElementById('studio-address').value = studio.address || '';
            document.getElementById('studio-coords').value = studio.coords ? studio.coords.join(', ') : '';
            document.getElementById('studio-styles').value = Array.isArray(studio.styles) ? studio.styles.join(', ') : (studio.styles || '');
            
            editingIndex.studios = index;
            document.getElementById('studioForm').querySelector('button[type="submit"]').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            document.getElementById('studioForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderStudios() {
            const list = document.getElementById('studiosList');
            if (data.studios.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>–ù–µ—Ç —Å—Ç—É–¥–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p></div>';
                return;
            }
            list.innerHTML = data.studios.map((studio, index) => {
                const metroStr = Array.isArray(studio.metro) ? studio.metro.join(', ') : studio.metro;
                return `
                <div class="item-card">
                    <h3>${studio.name}</h3>
                    <div class="item-info">
                        <div><strong>ID:</strong> ${studio.id}</div>
                        <div><strong>–ì–æ—Ä–æ–¥:</strong> ${studio.city}</div>
                        <div><strong>–ú–µ—Ç—Ä–æ:</strong> ${metroStr}</div>
                        <div><strong>–°—Ç–∏–ª–∏:</strong> ${studio.styles?.join(', ') || ''}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-sm" onclick="editStudio(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteStudio(${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `;
            }).join('');
        }

        function deleteStudio(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—É–¥–∏—é?')) {
                data.studios.splice(index, 1);
                renderStudios();
                showStatus('–°—Ç—É–¥–∏—è —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
        function addEducation(e) {
            e.preventDefault();
            const coords = parseCoords(document.getElementById('edu-coords').value);
            const edu = {
                id: document.getElementById('edu-id').value,
                name: document.getElementById('edu-name').value,
                short_name: document.getElementById('edu-short-name').value,
                city: document.getElementById('edu-city').value,
                type: document.getElementById('edu-type').value,
                metro: document.getElementById('edu-metro').value.split(',').map(s => s.trim()).filter(s => s),
                image: document.getElementById('edu-image').value,
                url: document.getElementById('edu-url').value,
                coords: coords,
                level: document.getElementById('edu-level').value.split(',').map(s => s.trim()).filter(s => s),
                programs: document.getElementById('edu-programs').value.split(',').map(s => s.trim()).filter(s => s)
            };
            
            if (editingIndex.education !== null) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                data.education[editingIndex.education] = edu;
                editingIndex.education = null;
                document.getElementById('educationForm').reset();
                document.getElementById('educationForm').querySelector('button[type="submit"]').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ';
                renderEducation();
                showStatus('–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                data.education.push(edu);
                document.getElementById('educationForm').reset();
                renderEducation();
                showStatus('–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
            }
        }

        function editEducation(index) {
            const edu = data.education[index];
            document.getElementById('edu-id').value = edu.id || '';
            document.getElementById('edu-name').value = edu.name || '';
            document.getElementById('edu-short-name').value = edu.short_name || '';
            document.getElementById('edu-city').value = edu.city || '';
            document.getElementById('edu-type').value = edu.type || '–í–£–ó';
            document.getElementById('edu-metro').value = Array.isArray(edu.metro) ? edu.metro.join(', ') : '';
            document.getElementById('edu-image').value = edu.image || '';
            document.getElementById('edu-url').value = edu.url || '';
            document.getElementById('edu-coords').value = edu.coords ? edu.coords.join(', ') : '';
            document.getElementById('edu-level').value = Array.isArray(edu.level) ? edu.level.join(', ') : '';
            document.getElementById('edu-programs').value = Array.isArray(edu.programs) ? edu.programs.join(', ') : '';
            
            editingIndex.education = index;
            document.getElementById('educationForm').querySelector('button[type="submit"]').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            document.getElementById('educationForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderEducation() {
            const list = document.getElementById('educationList');
            if (data.education.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>–ù–µ—Ç —É—á—Ä–µ–∂–¥–µ–Ω–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ!</p></div>';
                return;
            }
            list.innerHTML = data.education.map((edu, index) => {
                const metroList = Array.isArray(edu.metro) ? edu.metro.join(', ') : (edu.metro || '');
                return `
                <div class="item-card">
                    <h3>${edu.name}</h3>
                    <div class="item-info">
                        <div><strong>ID:</strong> ${edu.id}</div>
                        <div><strong>–ì–æ—Ä–æ–¥:</strong> ${edu.city}</div>
                        <div><strong>–ú–µ—Ç—Ä–æ:</strong> ${metroList || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                        <div><strong>–¢–∏–ø:</strong> ${edu.type}</div>
                        <div><strong>–£—Ä–æ–≤–Ω–∏:</strong> ${edu.level?.join(', ') || ''}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-sm" onclick="editEducation(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEducation(${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `;
            }).join('');
        }

        function deleteEducation(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ?')) {
                data.education.splice(index, 1);
                renderEducation();
                showStatus('–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
            }
        }

        // –°–æ–±—ã—Ç–∏—è
        function addEvent(e) {
            e.preventDefault();
            const startDate = new Date(document.getElementById('event-start-date').value);
            const endDate = document.getElementById('event-end-date').value 
                ? new Date(document.getElementById('event-end-date').value)
                : null;

            const event = {
                id: parseInt(document.getElementById('event-id').value),
                title: document.getElementById('event-title').value,
                description: document.getElementById('event-description').value,
                site_url: document.getElementById('event-site-url').value,
                city: document.getElementById('event-city').value,
                price: document.getElementById('event-price').value,
                place: {
                    title: document.getElementById('event-place').value,
                    address: document.getElementById('event-place').value
                },
                images: document.getElementById('event-image').value ? [{
                    image: document.getElementById('event-image').value
                }] : [],
                dates: [{
                    start: Math.floor(startDate.getTime() / 1000),
                    start_date: startDate.toISOString().split('T')[0]
                }]
            };

            if (endDate) {
                event.dates.push({
                    start: Math.floor(endDate.getTime() / 1000),
                    start_date: endDate.toISOString().split('T')[0]
                });
            }

            if (editingIndex.events !== null) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                data.events[editingIndex.events] = event;
                editingIndex.events = null;
                document.getElementById('eventForm').reset();
                document.getElementById('eventForm').querySelector('button[type="submit"]').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ';
                renderEvents();
                showStatus('–°–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                data.events.push(event);
                document.getElementById('eventForm').reset();
                renderEvents();
                showStatus('–°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
            }
        }

        function editEvent(index) {
            const event = data.events[index];
            document.getElementById('event-id').value = event.id || '';
            document.getElementById('event-title').value = event.title || '';
            document.getElementById('event-description').value = event.description || '';
            document.getElementById('event-site-url').value = event.site_url || '';
            document.getElementById('event-city').value = event.city || '';
            document.getElementById('event-price').value = event.price || '';
            document.getElementById('event-place').value = event.place?.title || event.place?.address || '';
            document.getElementById('event-image').value = event.images?.[0]?.image || '';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—ã
            if (event.dates && event.dates.length > 0) {
                const firstDate = new Date(event.dates[0].start * 1000);
                document.getElementById('event-start-date').value = firstDate.toISOString().slice(0, 16);
                
                if (event.dates.length > 1) {
                    const lastDate = new Date(event.dates[event.dates.length - 1].start * 1000);
                    document.getElementById('event-end-date').value = lastDate.toISOString().slice(0, 16);
                }
            }
            
            editingIndex.events = index;
            document.getElementById('eventForm').querySelector('button[type="submit"]').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            document.getElementById('eventForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderEvents() {
            const list = document.getElementById('eventsList');
            if (data.events.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ!</p></div>';
                return;
            }
            list.innerHTML = data.events.map((event, index) => {
                const date = event.dates?.[0]?.start_date || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
                return `
                    <div class="item-card">
                        <h3>${event.title}</h3>
                        <div class="item-info">
                            <div><strong>ID:</strong> ${event.id}</div>
                            <div><strong>–ì–æ—Ä–æ–¥:</strong> ${event.city}</div>
                            <div><strong>–ú–µ—Å—Ç–æ:</strong> ${event.place?.title || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                            <div><strong>–î–∞—Ç–∞:</strong> ${date}</div>
                            <div><strong>–¶–µ–Ω–∞:</strong> ${event.price}</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-primary btn-sm" onclick="editEvent(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteEvent(${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteEvent(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?')) {
                data.events.splice(index, 1);
                renderEvents();
                showStatus('–°–æ–±—ã—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ');
            }
        }

        // RSS
        function addRss(e) {
            e.preventDefault();
            const rss = {
                url: document.getElementById('rss-url').value,
                name: document.getElementById('rss-name').value,
                category: document.getElementById('rss-category').value,
                enabled: document.getElementById('rss-enabled').checked
            };
            
            if (editingIndex.rss !== null) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                data.rss[editingIndex.rss] = rss;
                editingIndex.rss = null;
                document.getElementById('rssForm').reset();
                document.getElementById('rssForm').querySelector('button[type="submit"]').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å RSS';
                renderRss();
                showStatus('RSS —Ñ–∏–¥ –æ–±–Ω–æ–≤–ª–µ–Ω!');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                data.rss.push(rss);
                document.getElementById('rssForm').reset();
                renderRss();
                showStatus('RSS —Ñ–∏–¥ –¥–æ–±–∞–≤–ª–µ–Ω!');
            }
        }

        function editRss(index) {
            const rss = data.rss[index];
            document.getElementById('rss-url').value = rss.url || '';
            document.getElementById('rss-name').value = rss.name || '';
            document.getElementById('rss-category').value = rss.category || '';
            document.getElementById('rss-enabled').checked = rss.enabled !== false;
            
            editingIndex.rss = index;
            document.getElementById('rssForm').querySelector('button[type="submit"]').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            document.getElementById('rssForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderRss() {
            const list = document.getElementById('rssList');
            if (data.rss.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>–ù–µ—Ç RSS —Ñ–∏–¥–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</p></div>';
                return;
            }
            list.innerHTML = data.rss.map((rss, index) => `
                <div class="item-card">
                    <h3>${rss.name}</h3>
                    <div class="item-info">
                        <div><strong>URL:</strong> ${rss.url}</div>
                        <div><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${rss.category}</div>
                        <div><strong>–í–∫–ª—é—á–µ–Ω:</strong> ${rss.enabled ? '–î–∞' : '–ù–µ—Ç'}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-sm" onclick="editRss(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteRss(${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteRss(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç RSS —Ñ–∏–¥?')) {
                data.rss.splice(index, 1);
                renderRss();
                showStatus('RSS —Ñ–∏–¥ —É–¥–∞–ª–µ–Ω');
            }
        }

        // Telegram
        function addTelegram(e) {
            e.preventDefault();
            const telegram = {
                id: document.getElementById('telegram-id').value,
                name: document.getElementById('telegram-name').value,
                enabled: document.getElementById('telegram-enabled').checked
            };
            
            if (editingIndex.telegram !== null) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                data.telegram[editingIndex.telegram] = telegram;
                editingIndex.telegram = null;
                document.getElementById('telegramForm').reset();
                document.getElementById('telegramForm').querySelector('button[type="submit"]').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª';
                renderTelegram();
                showStatus('Telegram –∫–∞–Ω–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω!');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                data.telegram.push(telegram);
                document.getElementById('telegramForm').reset();
                renderTelegram();
                showStatus('Telegram –∫–∞–Ω–∞–ª –¥–æ–±–∞–≤–ª–µ–Ω!');
            }
        }

        function editTelegram(index) {
            const telegram = data.telegram[index];
            document.getElementById('telegram-id').value = telegram.id || '';
            document.getElementById('telegram-name').value = telegram.name || '';
            document.getElementById('telegram-enabled').checked = telegram.enabled !== false;
            
            editingIndex.telegram = index;
            document.getElementById('telegramForm').querySelector('button[type="submit"]').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            document.getElementById('telegramForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderTelegram() {
            const list = document.getElementById('telegramList');
            if (data.telegram.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>–ù–µ—Ç –∫–∞–Ω–∞–ª–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</p></div>';
                return;
            }
            list.innerHTML = data.telegram.map((tg, index) => `
                <div class="item-card">
                    <h3>${tg.name}</h3>
                    <div class="item-info">
                        <div><strong>ID:</strong> ${tg.id}</div>
                        <div><strong>–í–∫–ª—é—á–µ–Ω:</strong> ${tg.enabled ? '–î–∞' : '–ù–µ—Ç'}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-sm" onclick="editTelegram(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTelegram(${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteTelegram(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª?')) {
                data.telegram.splice(index, 1);
                renderTelegram();
                showStatus('–ö–∞–Ω–∞–ª —É–¥–∞–ª–µ–Ω');
            }
        }

        // VK
        function addVk(e) {
            e.preventDefault();
            const vk = {
                id: document.getElementById('vk-id').value,
                name: document.getElementById('vk-name').value,
                enabled: document.getElementById('vk-enabled').checked
            };
            
            if (editingIndex.vk !== null) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                data.vk[editingIndex.vk] = vk;
                editingIndex.vk = null;
                document.getElementById('vkForm').reset();
                document.getElementById('vkForm').querySelector('button[type="submit"]').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É';
                renderVk();
                showStatus('VK –≥—Ä—É–ø–ø–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                data.vk.push(vk);
                document.getElementById('vkForm').reset();
                renderVk();
                showStatus('VK –≥—Ä—É–ø–ø–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            }
        }

        function editVk(index) {
            const vk = data.vk[index];
            document.getElementById('vk-id').value = vk.id || '';
            document.getElementById('vk-name').value = vk.name || '';
            document.getElementById('vk-enabled').checked = vk.enabled !== false;
            
            editingIndex.vk = index;
            document.getElementById('vkForm').querySelector('button[type="submit"]').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            document.getElementById('vkForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderVk() {
            const list = document.getElementById('vkList');
            if (data.vk.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>–ù–µ—Ç –≥—Ä—É–ø–ø. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p></div>';
                return;
            }
            list.innerHTML = data.vk.map((vk, index) => `
                <div class="item-card">
                    <h3>${vk.name}</h3>
                    <div class="item-info">
                        <div><strong>ID:</strong> ${vk.id}</div>
                        <div><strong>–í–∫–ª—é—á–µ–Ω:</strong> ${vk.enabled ? '–î–∞' : '–ù–µ—Ç'}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-sm" onclick="editVk(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteVk(${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteVk(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É?')) {
                data.vk.splice(index, 1);
                renderVk();
                showStatus('–ì—Ä—É–ø–ø–∞ —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // –£—Ç–∏–ª–∏—Ç—ã
        function parseCoords(str) {
            if (!str || !str.trim()) return undefined;
            const parts = str.split(',').map(s => parseFloat(s.trim()));
            if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
                return parts;
            }
            return undefined;
        }

        function renderAll() {
            renderStudios();
            renderEducation();
            renderEvents();
            renderRss();
            renderTelegram();
            renderVk();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        function saveToFile() {
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'config.json';
            a.click();
            URL.revokeObjectURL(url);
            showStatus('–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }

        function exportJSON() {
            const json = JSON.stringify(data, null, 2);
            const textarea = document.createElement('textarea');
            textarea.value = json;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showStatus('JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }

        async function saveToGist() {
            if (!gistConfig.id || !gistConfig.token) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Gist –≤ —Ä–∞–∑–¥–µ–ª–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Gist"', 'error');
                return;
            }

            try {
                const json = JSON.stringify(data, null, 2);
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞: fine-grained –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å ghp_, classic –º–æ–∂–µ—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å ghp_ –∏–ª–∏ gho_
                // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–±—É–µ–º –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞
                const token = gistConfig.token.trim();
                const authHeader = token.startsWith('ghp_') || token.startsWith('gho_') 
                    ? `token ${token}`  // Classic token
                    : `Bearer ${token}`; // Fine-grained token (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
                
                const response = await fetch(`https://api.github.com/gists/${gistConfig.id}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': authHeader,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json',
                        'X-GitHub-Api-Version': '2022-11-28'
                    },
                    body: JSON.stringify({
                        files: {
                            'config.json': {
                                content: json
                            }
                        }
                    })
                });

                if (response.ok) {
                    showStatus('‚úÖ Gist —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                } else {
                    const error = await response.json();
                    showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Gist: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        function saveGistConfig() {
            gistConfig.id = document.getElementById('gist-id').value;
            gistConfig.token = document.getElementById('gist-token').value;
            localStorage.setItem('gist_id', gistConfig.id);
            localStorage.setItem('gist_token', gistConfig.token);
            if (gistConfig.id && gistConfig.token) {
                document.getElementById('saveGistBtn').style.display = 'inline-flex';
            }
            showStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Gist —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        function loadGistConfig() {
            document.getElementById('gist-id').value = gistConfig.id;
            document.getElementById('gist-token').value = gistConfig.token;
        }

        function clearAll() {
            if (confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                data = {
                    studios: [],
                    education: [],
                    events: [],
                    rss: [],
                    rss_world: [],
                    telegram: [],
                    vk: [],
                    vk_clips: []
                };
                renderAll();
                showStatus('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            }
        }
    </script>
</body>
</html>
